<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Steelers Typing Challenge</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; display: grid; place-items: center; min-height: 100vh; background: #f6f7fb; overflow-x: hidden; }
    .card {
      width: min(900px, 94vw);
      background: white;
      border-radius: 18px;
      padding: 22px;
      box-shadow: 0 10px 30px rgba(0,0,0,.08);
      position: relative;
    }
    h1 { margin: 0 0 8px; font-size: 28px; }
    .sub { margin: 0 0 14px; opacity: .75; font-size: 14px; }

    .row { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin: 14px 0 18px; }
    @media (max-width: 820px) { .row { grid-template-columns: repeat(2, 1fr); } }

    .stat { background: #f2f4ff; border-radius: 14px; padding: 12px; }
    .stat .label { font-size: 12px; opacity: .7; }
    .stat .value { font-size: 22px; font-weight: 800; margin-top: 4px; }

    .controls { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; margin: 10px 0 6px; }
    .pill {
      background: #eef1ff;
      border-radius: 999px;
      padding: 8px 10px;
      display: inline-flex;
      gap: 10px;
      align-items: center;
      font-weight: 700;
      font-size: 14px;
    }
    .pill label { display: inline-flex; gap: 6px; align-items: center; cursor: pointer; }
    .pill input { cursor: pointer; }

    .wordBox {
      background: #111827;
      color: white;
      border-radius: 16px;
      padding: 18px;
      text-align: center;
      font-size: 44px;
      font-weight: 900;
      letter-spacing: 0.5px;
      margin: 12px 0 14px;
      user-select: none;
    }
    @media (max-width: 520px) { .wordBox { font-size: 34px; } }

    input#typeBox {
      width: 100%;
      box-sizing: border-box;
      font-size: 22px;
      padding: 14px 16px;
      border-radius: 14px;
      border: 2px solid #d7dbe7;
      outline: none;
    }
    input#typeBox:focus { border-color: #6b7cff; box-shadow: 0 0 0 4px rgba(107,124,255,.15); }

    .btns { display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap; }
    button {
      border: 0;
      border-radius: 14px;
      padding: 12px 16px;
      font-size: 16px;
      font-weight: 800;
      cursor: pointer;
    }
    button:disabled { opacity: .6; cursor: not-allowed; }
    .primary { background: #6b7cff; color: white; }
    .secondary { background: #eef1ff; }
    .danger { background: #fee2e2; }
    .note { margin-top: 10px; font-size: 13px; opacity: .75; }
    .hidden { display: none; }

    .panelGrid { display: grid; grid-template-columns: 1.3fr 1fr; gap: 12px; margin-top: 14px; }
    @media (max-width: 820px) { .panelGrid { grid-template-columns: 1fr; } }

    .panel {
      border-radius: 14px;
      padding: 14px;
      background: #f8fafc;
      border: 1px solid #e5e7eb;
    }
    .panel h2 { margin: 0 0 10px; font-size: 18px; }
    .panel small { opacity: .7; }

    textarea {
      width: 100%;
      box-sizing: border-box;
      min-height: 140px;
      resize: vertical;
      border-radius: 12px;
      border: 1px solid #d7dbe7;
      padding: 10px;
      font-size: 14px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      outline: none;
      background: white;
    }

    .result {
      margin-top: 14px;
      border-radius: 14px;
      padding: 14px;
      background: #ecfeff;
      border: 1px solid #a5f3fc;
      font-size: 14px;
    }

    table { width: 100%; border-collapse: collapse; font-size: 14px; }
    th, td { text-align: left; padding: 8px 6px; border-bottom: 1px solid #e5e7eb; }
    th { font-size: 12px; opacity: .7; }

    /* Floating footballs */
    .floatLayer { position: absolute; inset: 0; pointer-events: none; overflow: hidden; border-radius: 18px; }
    .ball {
      position: absolute;
      font-size: 26px;
      will-change: transform, opacity;
      opacity: .9;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,.18));
      animation: drift linear forwards;
    }
    @keyframes drift {
      0%   { transform: translateX(-10%) translateY(var(--y)) rotate(0deg) scale(0.9); opacity: 0; }
      10%  { opacity: 1; }
      100% { transform: translateX(115%) translateY(var(--y)) rotate(360deg) scale(1.1); opacity: 0; }
    }

    /* Confetti */
    .confetti {
      position: fixed;
      top: -12px;
      width: 10px;
      height: 14px;
      border-radius: 2px;
      pointer-events: none;
      will-change: transform, opacity;
      animation: fall linear forwards;
      opacity: 0.95;
    }
    @keyframes fall {
      0%   { transform: translate(var(--x), -20px) rotate(0deg); opacity: 1; }
      100% { transform: translate(calc(var(--x) + var(--dx)), 110vh) rotate(720deg); opacity: 0.9; }
    }

    /* Countdown overlay */
    .countdownOverlay{
      position: absolute;
      inset: 0;
      border-radius: 18px;
      background: rgba(17,24,39,.78);
      display: grid;
      place-items: center;
      z-index: 10;
      user-select: none;
    }
    .countdownOverlay.hidden{ display:none; }
    .countdownText{
      color: white;
      font-weight: 1000;
      font-size: clamp(48px, 10vw, 110px);
      letter-spacing: 1px;
      text-align: center;
      padding: 10px 16px;
    }
    .countdownSub{
      display:block;
      font-weight: 800;
      font-size: clamp(14px, 2.2vw, 22px);
      opacity: .9;
      margin-top: 10px;
    }
  </style>
</head>

<body>
  <div class="card">
    <div class="floatLayer" id="floatLayer"></div>

    <!-- Countdown -->
    <div class="countdownOverlay hidden" id="countdownOverlay">
      <div class="countdownText" id="countdownText">
        3 <span class="countdownSub">Get ready‚Ä¶</span>
      </div>
    </div>

    <h1>Steelers Typing Challenge üñ§üíõ</h1>
    <p class="sub">Press <b>Enter</b> or <b>Space</b> to submit. (Case doesn‚Äôt matter.)</p>

    <div class="controls">
      <div class="pill" title="Choose the round length">
        Round:
        <label><input type="radio" name="roundLen" value="30">30s</label>
        <label><input type="radio" name="roundLen" value="60" checked>60s</label>
      </div>

      <div class="pill" title="Teacher edit mode shows the word list editor and leaderboard tools">
        <label><input type="checkbox" id="teacherToggle">Teacher Edit Mode</label>
      </div>
    </div>

    <div class="row">
      <div class="stat"><div class="label">Time Left</div><div class="value" id="timeLeft">60</div></div>
      <div class="stat"><div class="label">Correct</div><div class="value" id="correct">0</div></div>
      <div class="stat"><div class="label">Attempts</div><div class="value" id="attempts">0</div></div>
      <div class="stat"><div class="label">Accuracy</div><div class="value" id="accuracy">100%</div></div>
      <div class="stat"><div class="label">WPM (est.)</div><div class="value" id="wpm">0</div></div>
    </div>

    <div class="wordBox" id="targetWord">Press Start</div>
    <input id="typeBox" type="text" placeholder="Type the word here‚Ä¶" autocomplete="off" disabled />

    <div class="btns">
      <button class="primary" id="startBtn">Start</button>
      <button class="secondary" id="resetBtn">Reset</button>
    </div>

    <div class="result hidden" id="resultBox"></div>

    <div class="panelGrid hidden" id="teacherPanel">
      <div class="panel">
        <h2>Teacher Word List</h2>
        <small>One word per line or comma-separated. Click ‚ÄúApply List‚Äù to use it.</small>
        <div style="height:10px"></div>
        <textarea id="wordEditor"></textarea>
        <div class="btns">
          <button class="secondary" id="applyWordsBtn">Apply List</button>
          <button class="secondary" id="resetWordsBtn">Reset to Steelers List</button>
        </div>
      </div>

      <div class="panel">
        <h2>Leaderboard (This Device)</h2>
        <small>Saves automatically after each round.</small>
        <div style="height:10px"></div>
        <div id="leaderboardWrap"></div>
        <div class="btns">
          <button class="secondary" id="exportBtn">Export Scores</button>
          <button class="danger" id="clearScoresBtn">Clear Scores</button>
        </div>
        <div class="note">Tip: Export gives you a copy/paste text block.</div>
      </div>
    </div>
  </div>

  <script>
    // =========================
    // 1) DEFAULT WORD LIST (updated)
    // Removed 4 of the longest: quarterback, Pittsburgh, scoreboard, touchdown
    // Added: cheer, clap, yell, shout
    // =========================
    const DEFAULT_RAW_WORDS = `
Steelers
football
players
kicker
field
fans
bleachers
stadium
Acrisure
victory
overtime
black
yellow
team
run
throw
cheer
clap
yell
shout
`.trim();

    // =========================
    // 2) STORAGE KEYS
    // =========================
    const LS_WORDS_KEY = "typingGameWords_v1";
    const LS_SCORES_KEY = "typingGameScores_v1";

    // =========================
    // 3) HELPERS
    // =========================
    function parseWords(raw) {
      return raw
        .split(/[\n,]+/)
        .map(w => w.trim())
        .filter(Boolean);
    }

    function nowStamp() {
      const d = new Date();
      return d.toLocaleString(undefined, { month:"2-digit", day:"2-digit", year:"numeric", hour:"2-digit", minute:"2-digit" });
    }

    // =========================
    // 4) LOAD WORDS (teacher edit persists)
    // =========================
    const savedRaw = localStorage.getItem(LS_WORDS_KEY);
    let RAW_WORDS = (savedRaw && savedRaw.trim()) ? savedRaw : DEFAULT_RAW_WORDS;
    let WORDS = parseWords(RAW_WORDS);

    // =========================
    // 5) GAME SETTINGS
    // =========================
    let ROUND_SECONDS = 60;

    // =========================
    // 6) STATE
    // =========================
    let timer = null;
    let started = false;
    let timeLeft = ROUND_SECONDS;

    let correct = 0;
    let attempts = 0;
    let charsCorrect = 0;
    let currentWord = "";

    // Football animation interval
    let ballTimer = null;

    // Countdown state
    let isCountingDown = false;
    let countdownTimer = null;

    // =========================
    // 7) ELEMENTS
    // =========================
    const timeEl = document.getElementById("timeLeft");
    const correctEl = document.getElementById("correct");
    const attemptsEl = document.getElementById("attempts");
    const accEl = document.getElementById("accuracy");
    const wpmEl = document.getElementById("wpm");
    const targetEl = document.getElementById("targetWord");
    const inputEl = document.getElementById("typeBox");
    const startBtn = document.getElementById("startBtn");
    const resetBtn = document.getElementById("resetBtn");
    const resultBox = document.getElementById("resultBox");
    const floatLayer = document.getElementById("floatLayer");

    const teacherToggle = document.getElementById("teacherToggle");
    const teacherPanel = document.getElementById("teacherPanel");
    const wordEditor = document.getElementById("wordEditor");
    const applyWordsBtn = document.getElementById("applyWordsBtn");
    const resetWordsBtn = document.getElementById("resetWordsBtn");
    const leaderboardWrap = document.getElementById("leaderboardWrap");
    const clearScoresBtn = document.getElementById("clearScoresBtn");
    const exportBtn = document.getElementById("exportBtn");

    const countdownOverlay = document.getElementById("countdownOverlay");
    const countdownText = document.getElementById("countdownText");

    // Round length radios
    const roundRadios = Array.from(document.querySelectorAll('input[name="roundLen"]'));

    // =========================
    // 8) WORD PICKING
    // =========================
    function pickWord() {
      if (!WORDS.length) return "Add words!";
      const i = Math.floor(Math.random() * WORDS.length);
      return WORDS[i];
    }

    function showWord() {
      currentWord = pickWord();
      targetEl.textContent = currentWord;
    }

    // =========================
    // 9) STATS
    // =========================
    function updateStats() {
      timeEl.textContent = timeLeft;
      correctEl.textContent = correct;
      attemptsEl.textContent = attempts;

      const accuracy = attempts === 0 ? 100 : Math.round((correct / attempts) * 100);
      accEl.textContent = accuracy + "%";

      const elapsed = ROUND_SECONDS - timeLeft;
      const minutes = Math.max(elapsed / 60, 1/60);
      const wpm = Math.round((charsCorrect / 5) / minutes);
      wpmEl.textContent = isFinite(wpm) ? wpm : 0;
    }

    // =========================
    // 10) FOOTBALL ANIMATION
    // =========================
    function spawnFootball() {
      const el = document.createElement("div");
      el.className = "ball";
      el.textContent = "üèà";
      const y = Math.floor(Math.random() * 70) + 10; // % inside card
      const dur = (Math.random() * 2.2 + 2.2).toFixed(2); // 2.2s - 4.4s
      el.style.setProperty("--y", y + "%");
      el.style.left = "-10%";
      el.style.top = y + "%";
      el.style.animationDuration = dur + "s";
      floatLayer.appendChild(el);
      setTimeout(() => el.remove(), (parseFloat(dur) * 1000) + 300);
    }

    function startFootball() {
      stopFootball();
      ballTimer = setInterval(spawnFootball, 420);
    }

    function stopFootball() {
      if (ballTimer) clearInterval(ballTimer);
      ballTimer = null;
      Array.from(floatLayer.querySelectorAll(".ball")).forEach(b => b.remove());
    }

    // =========================
    // 11) CONFETTI (NO LIBS)
    // =========================
    function launchConfetti(count = 140) {
      const colors = ["#111827","#facc15","#6b7cff","#22c55e","#ef4444","#0ea5e9","#a855f7","#f97316"];
      for (let i = 0; i < count; i++) {
        const c = document.createElement("div");
        c.className = "confetti";
        c.style.background = colors[Math.floor(Math.random() * colors.length)];
        const x = Math.floor(Math.random() * 100);
        const dx = (Math.random() * 200 - 100).toFixed(0) + "px";
        const dur = (Math.random() * 1.8 + 2.2).toFixed(2) + "s";
        const delay = (Math.random() * 0.25).toFixed(2) + "s";
        c.style.setProperty("--x", x + "vw");
        c.style.setProperty("--dx", dx);
        c.style.animationDuration = dur;
        c.style.animationDelay = delay;
        c.style.left = x + "vw";
        c.style.width = (Math.random() * 8 + 6).toFixed(0) + "px";
        c.style.height = (Math.random() * 10 + 8).toFixed(0) + "px";
        document.body.appendChild(c);
        setTimeout(() => c.remove(), (parseFloat(dur) + parseFloat(delay)) * 1000 + 200);
      }
    }

    // =========================
    // 12) LEADERBOARD (LOCAL)
    // =========================
    function loadScores() {
      try { return JSON.parse(localStorage.getItem(LS_SCORES_KEY) || "[]"); }
      catch { return []; }
    }

    function saveScores(scores) {
      localStorage.setItem(LS_SCORES_KEY, JSON.stringify(scores));
    }

    function addScore(entry) {
      const scores = loadScores();
      scores.unshift(entry);
      saveScores(scores.slice(0, 20));
      renderLeaderboard();
    }

    function renderLeaderboard() {
      const scores = loadScores();
      if (!scores.length) {
        leaderboardWrap.innerHTML = "<div class='note'>No scores saved yet.</div>";
        return;
      }

      leaderboardWrap.innerHTML = `
        <table>
          <thead>
            <tr>
              <th>When</th>
              <th>Round</th>
              <th>Correct</th>
              <th>Accuracy</th>
              <th>WPM</th>
            </tr>
          </thead>
          <tbody>
            ${scores.map(s => `
              <tr>
                <td>${s.when}</td>
                <td>${s.round}s</td>
                <td>${s.correct}</td>
                <td>${s.accuracy}%</td>
                <td>${s.wpm}</td>
              </tr>
            `).join("")}
          </tbody>
        </table>
      `;
    }

    function exportScoresText() {
      const scores = loadScores();
      if (!scores.length) return "No scores yet.";
      return scores.map(s =>
        `${s.when} | ${s.round}s | correct:${s.correct} | attempts:${s.attempts} | acc:${s.accuracy}% | wpm:${s.wpm}`
      ).join("\n");
    }

    // =========================
    // 13) COUNTDOWN (3-2-1-GO)
    // =========================
    function setUIEnabled(enabled) {
      startBtn.disabled = !enabled;
      teacherToggle.disabled = !enabled;
      roundRadios.forEach(r => r.disabled = !enabled);
      // reset stays enabled so you can bail out anytime
      resetBtn.disabled = false;
    }

    function stopCountdown() {
      if (countdownTimer) clearInterval(countdownTimer);
      countdownTimer = null;
      isCountingDown = false;
      countdownOverlay.classList.add("hidden");
      countdownText.innerHTML = `3 <span class="countdownSub">Get ready‚Ä¶</span>`;
    }

    function startCountdown(onDone) {
      stopCountdown();
      isCountingDown = true;
      setUIEnabled(false);

      countdownOverlay.classList.remove("hidden");

      const steps = ["3", "2", "1", "GO!"];
      let idx = 0;

      function renderStep() {
        const val = steps[idx];
        if (val === "GO!") {
          countdownText.innerHTML = `GO! <span class="countdownSub">Type fast!</span>`;
        } else {
          countdownText.innerHTML = `${val} <span class="countdownSub">Get ready‚Ä¶</span>`;
        }
      }

      renderStep();

      countdownTimer = setInterval(() => {
        idx++;
        if (idx >= steps.length) {
          clearInterval(countdownTimer);
          countdownTimer = null;
          countdownOverlay.classList.add("hidden");
          isCountingDown = false;
          setUIEnabled(true);
          onDone?.();
          return;
        }
        renderStep();
      }, 900);
    }

    // =========================
    // 14) GAME FLOW
    // =========================
    function syncRoundLengthFromUI() {
      const sel = roundRadios.find(r => r.checked);
      ROUND_SECONDS = sel ? parseInt(sel.value, 10) : 60;
      if (!started && !isCountingDown) {
        timeLeft = ROUND_SECONDS;
        updateStats();
      }
    }

    function startGame() {
      if (started || isCountingDown) return;

      if (!WORDS.length) {
        targetEl.textContent = "Add words!";
        resultBox.classList.remove("hidden");
        resultBox.textContent = "Teacher: Turn on Teacher Edit Mode and add a word list.";
        return;
      }

      syncRoundLengthFromUI();

      // Prep state (but don't start timer until countdown ends)
      timeLeft = ROUND_SECONDS;
      correct = 0;
      attempts = 0;
      charsCorrect = 0;
      currentWord = "";

      resultBox.classList.add("hidden");
      resultBox.textContent = "";

      inputEl.disabled = true;
      inputEl.value = "";
      targetEl.textContent = "Get ready‚Ä¶";
      updateStats();

      startCountdown(() => {
        started = true;

        inputEl.disabled = false;
        inputEl.focus();

        showWord();
        updateStats();
        startFootball();

        timer = setInterval(() => {
          timeLeft--;
          updateStats();
          if (timeLeft <= 0) endGame();
        }, 1000);
      });
    }

    function endGame() {
      clearInterval(timer);
      timer = null;
      started = false;

      stopFootball();

      inputEl.disabled = true;
      targetEl.textContent = "Time!";
      updateStats();

      const accuracy = attempts === 0 ? 100 : Math.round((correct / attempts) * 100);
      const wpm = parseInt(wpmEl.textContent, 10) || 0;

      launchConfetti(160);

      addScore({
        when: nowStamp(),
        round: ROUND_SECONDS,
        correct,
        attempts,
        accuracy,
        wpm
      });

      resultBox.classList.remove("hidden");
      resultBox.innerHTML = `
        <b>Round Results</b><br>
        Correct: <b>${correct}</b><br>
        Attempts: <b>${attempts}</b><br>
        Accuracy: <b>${accuracy}%</b><br>
        WPM (est.): <b>${wpm}</b>
      `;
    }

    function resetGame() {
      // stop countdown if running
      stopCountdown();

      clearInterval(timer);
      timer = null;
      started = false;

      stopFootball();

      syncRoundLengthFromUI();

      correct = 0;
      attempts = 0;
      charsCorrect = 0;
      currentWord = "";

      inputEl.value = "";
      inputEl.disabled = true;
      targetEl.textContent = "Press Start";
      resultBox.classList.add("hidden");
      resultBox.textContent = "";
      updateStats();
    }

    function submitAttempt() {
      if (!started) return;

      const typed = inputEl.value.trim();
      if (!typed) return;

      attempts++;

      if (typed.toLowerCase() === currentWord.toLowerCase()) {
        correct++;
        charsCorrect += currentWord.length;
      }

      inputEl.value = "";
      showWord();
      updateStats();
    }

    // =========================
    // 15) TEACHER MODE
    // =========================
    function setTeacherMode(on) {
      teacherPanel.classList.toggle("hidden", !on);
      if (on) {
        wordEditor.value = RAW_WORDS;
        renderLeaderboard();
      }
    }

    function applyWordsFromEditor() {
      const raw = (wordEditor.value || "").trim();
      RAW_WORDS = raw;
      WORDS = parseWords(RAW_WORDS);
      localStorage.setItem(LS_WORDS_KEY, RAW_WORDS);
      if (!started && !isCountingDown) {
        targetEl.textContent = WORDS.length ? "Press Start" : "Add words!";
      }
    }

    function resetWordsToDefault() {
      RAW_WORDS = DEFAULT_RAW_WORDS;
      WORDS = parseWords(RAW_WORDS);
      localStorage.setItem(LS_WORDS_KEY, RAW_WORDS);
      wordEditor.value = RAW_WORDS;
      if (!started && !isCountingDown) targetEl.textContent = "Press Start";
    }

    // =========================
    // 16) EVENTS
    // =========================
    inputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        submitAttempt();
      }
    });

    startBtn.addEventListener("click", startGame);
    resetBtn.addEventListener("click", resetGame);

    roundRadios.forEach(r => r.addEventListener("change", () => {
      if (started || isCountingDown) {
        roundRadios.forEach(rr => rr.checked = (parseInt(rr.value,10) === ROUND_SECONDS));
        return;
      }
      syncRoundLengthFromUI();
    }));

    teacherToggle.addEventListener("change", () => setTeacherMode(teacherToggle.checked));

    applyWordsBtn.addEventListener("click", () => {
      if (started || isCountingDown) return;
      applyWordsFromEditor();
      alert("Word list applied!");
    });

    resetWordsBtn.addEventListener("click", () => {
      if (started || isCountingDown) return;
      resetWordsToDefault();
      alert("Reset to Steelers list!");
    });

    clearScoresBtn.addEventListener("click", () => {
      localStorage.removeItem(LS_SCORES_KEY);
      renderLeaderboard();
      alert("Scores cleared.");
    });

    exportBtn.addEventListener("click", async () => {
      const text = exportScoresText();
      try {
        await navigator.clipboard.writeText(text);
        alert("Scores copied to clipboard!");
      } catch {
        prompt("Copy your scores:", text);
      }
    });

    // =========================
    // 17) INIT
    // =========================
    function init() {
      syncRoundLengthFromUI();
      updateStats();
      targetEl.textContent = "Press Start";
      setTeacherMode(false);
    }

    init();
  </script>
</body>
</html>
